-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69365','31133','17766','55579','81680','20035',
                          '17025','90779','14206','57968','89447',
                          '12559','25161','87418','30525','75245',
                          '64989','47726','38103','34016','41652',
                          '17839','83188','49632','59706','77101',
                          '18569','96217','46325','86290','45262',
                          '18624','20700','14874','45345','48385',
                          '65833','20833','48668','63405','35481',
                          '90632','63778','45236','53596','80780',
                          '56976','85608','24749','49484','13249',
                          '49291','47678','18075','32952','71403',
                          '67472','36238','62381','60671','41551',
                          '61102','91362','42313','92198','59853',
                          '99232','97450','53475','50477','62229',
                          '52567','44703','58398','78812','34225',
                          '81390','11627','91310','36778','47059',
                          '92736','26172','71075','62589','75797',
                          '37787','68878','83002','98321','19875',
                          '39878','50404','51297','22830','50567',
                          '55113','96780','78528','77610','39950',
                          '16651','36981','73651','42893','54169',
                          '54234','91395','20668','55775','24978',
                          '88965','19932','43653','35731','12985',
                          '36501','91068','78854','68561','55011',
                          '10340','97698','11564','26101','69578',
                          '15809','20333','34322','36010','98233',
                          '53600','23563','80100','87640','38958',
                          '47202','18821','19902','69960','45227',
                          '35672','61358','20185','68627','92640',
                          '44000','61608','31301','25252','27123',
                          '23065','50169','14894','91658','87179',
                          '58998','79778','68035','50043','85438',
                          '49710','95816','30808','23705','97507',
                          '56864','19189','71979','31143','34107',
                          '78766','42447','23619','70947','68894',
                          '59357','73933','84347','83124','74039',
                          '15025','21508','30896','50498','14431',
                          '16669','72546','69116','94296','32771',
                          '30339','31237','76183','51114','29778',
                          '88581','26957','44956','69198','21772',
                          '88083','80937','66217','31602','29522',
                          '12790','28477','10513','55218','31305',
                          '20879','40223','68648','69007','14688',
                          '42241','68437','59515','76143','11272',
                          '57087','35916','59655','39698','77932',
                          '21492','80503','10295','53925','34748',
                          '20454','31449','76494','43325','37638',
                          '96287','73788','59448','25738','81265',
                          '46031','26174','60439','53246','48403',
                          '85764','71067','64722','26173','50014',
                          '40281','81239','49909','88185','54785',
                          '69911','59735','51155','87996','54406',
                          '52407','35287','60134','78944','81932',
                          '71008','99094','22991','35038','44204',
                          '89012','42191','33891','26996','73630',
                          '12727','54580','14550','47329','14119',
                          '66736','67793','11735','36138','22940',
                          '77862','11139','95259','75525','82730',
                          '18589','68419','17169','69270','32369',
                          '14246','56368','19295','39809','72595',
                          '83369','65166','57922','51396','56185',
                          '73555','24195','45011','61982','10492',
                          '12414','26436','84039','17811','52425',
                          '66884','73582','76742','71245','92835',
                          '93072','11656','67174','19445','20653',
                          '17713','93447','16537','33679','26944',
                          '40875','95831','25001','29405','63629',
                          '91434','71351','81823','81695','53490',
                          '76347','13176','73622','10325','35753',
                          '36206','53766','97807','64752','90992',
                          '29008','48171','33467','23996','43131',
                          '74179','12778','30903','69285','10158',
                          '52003','95062','26283','78476','55936',
                          '66229','19531','53160','53267','19697',
                          '29705','47928','18349','64410','81815',
                          '19655','19661','87377','91546','22135',
                          '12022','56702','71760','19795','19112',
                          '64571','72047','88423','46850','56627',
                          '11195','24472','76678','97437','87035',
                          '83247','52288','35522','69468')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 63 in stream 0 using template query8.tpl
